<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    text-align: center;
    padding: 30px 0;
  }

  /* 時計 */
  #time {
    font-size: 72px;
    font-weight: 200;
    margin-bottom: 5px;
  }
  #date {
    font-size: 22px;
    color: #ccc;
    margin-bottom: 25px;
  }

  /* カード */
  .card {
    background: rgba(255,255,255,0.08);
    border-radius: 20px;
    padding: 20px;
    width: 85%;
    margin: 20px auto;
    backdrop-filter: blur(10px);
  }

  /* 現在の天気 */
  #icon-now {
    width: 90px;
    height: 90px;
  }
  #weather-now {
    font-size: 28px;
    margin-top: 10px;
  }

  .forecast-icon {
    width: 60px;
    height: 60px;
  }

  /* 横向き（ランドスケープ）時のレイアウト調整 */
  @media (orientation: landscape) {
    body {
      padding: 10px;
    }

    #time {
      font-size: 48px;
    }

    #date {
      font-size: 18px;
    }

    .card {
      width: 45%;
      display: inline-block;
      vertical-align: top;
      margin: 10px;
    }

    #icon-now {
      width: 70px;
      height: 70px;
    }

    .forecast-icon {
      width: 50px;
      height: 50px;
    }
  }
</style>
</head>
<body>

<!-- 時計 -->
<div id="time"></div>
<div id="date"></div>

<!-- 現在の天気 -->
<div class="card">
  <img id="icon-now" src="" alt="">
  <div id="weather-now">天気を取得中...</div>
</div>

<!-- 今日・明日 -->
<div class="card">
  <div id="today"></div>
  <img id="icon-today" class="forecast-icon" src="" alt="">
  <div style="height:15px"></div>
  <div id="tomorrow"></div>
  <img id="icon-tomorrow" class="forecast-icon" src="" alt="">
</div>

<script>
// 時計
function updateTime() {
  const now = new Date();
  const h = ("0" + now.getHours()).slice(-2);
  const m = ("0" + now.getMinutes()).slice(-2);
  document.getElementById("time").textContent = `${h}:${m}`;

  const week = ["日","月","火","水","木","金","土"];
  const dateStr = `${now.getMonth()+1}月${now.getDate()}日 (${week[now.getDay()]})`;
  document.getElementById("date").textContent = dateStr;
}
setInterval(updateTime, 1000);
updateTime();

// 天気 API
const API_KEY = "669c1ef483ce2b7c3b68ce475259d9a6";  // ←あなたのAPIキー
const LAT = 34.6913;
const LON = 135.1830;

// 現在の天気
function loadCurrentWeather() {
  const url = `https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&appid=${API_KEY}&units=metric&lang=ja`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const temp = Math.round(data.main.temp);
      const desc = data.weather[0].description;
      const icon = data.weather[0].icon;

      document.getElementById("icon-now").src =
        `https://openweathermap.org/img/wn/${icon}@2x.png`;
      document.getElementById("weather-now").textContent =
        `${temp}℃ ${desc}`;
    })
    .catch(() => {
      document.getElementById("weather-now").textContent = "取得失敗";
    });
}

// 今日・明日の天気（3時間ごと予報から抽出）
function loadForecast() {
  const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${LAT}&lon=${LON}&appid=${API_KEY}&units=metric&lang=ja`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const list = data.list;

      // 今日の昼12時
      const todayData = list.find(item => item.dt_txt.includes("12:00:00"));
      if (todayData) {
        document.getElementById("today").textContent =
          `今日: ${Math.round(todayData.main.temp)}℃ ${todayData.weather[0].description}`;
        document.getElementById("icon-today").src =
          `https://openweathermap.org/img/wn/${todayData.weather[0].icon}@2x.png`;
      }

      // 明日の昼12時
      const tomorrowData = list.find(item => {
        const d = new Date(item.dt_txt);
        const now = new Date();
        return d.getDate() === now.getDate() + 1 && item.dt_txt.includes("12:00:00");
      });

      if (tomorrowData) {
        document.getElementById("tomorrow").textContent =
          `明日: ${Math.round(tomorrowData.main.temp)}℃ ${tomorrowData.weather[0].description}`;
        document.getElementById("icon-tomorrow").src =
          `https://openweathermap.org/img/wn/${tomorrowData.weather[0].icon}@2x.png`;
      }
    });
}

loadCurrentWeather();
loadForecast();
setInterval(() => {
  loadCurrentWeather();
  loadForecast();
}, 10 * 60 * 1000);

</script>

</body>
</html>
